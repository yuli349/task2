// Ð¡Ð°Ð¼Ñ‹Ð¹ Ð²Ð½Ð¸Ð¼Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº.
// Ð“Ð¾Ð»Ð¾ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ Ð·Ð° ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ° ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ â€” Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ñ‚ ÑÐ¿Ð¸ÑÐ¾Ðº ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð² ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð¿Ð¾ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ‡Ð½Ð¾
// Ð¸ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð¿Ñ€Ð¾Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð°Ñ‚ÑŒ Ð·Ð° ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ° Ð² Ð¾Ð´Ð½Ð¾Ð¹ Ð¸Ð· Ð½Ð¾Ð¼Ð¸Ð½Ð°Ñ†Ð¸Ð¹.
import { VoteSlide } from '../typings/output';
import { Sprint } from '../typings/input';
import { Store } from '../store';
import { commentReducer, userVoteMapper, userFilter } from '../helpers/helpers';

const SLIDE_ALIAS = 'vote';
const SLIDE_TITLE = 'Ð¡Ð°Ð¼Ñ‹Ð¹ ðŸ”Ž Ð²Ð½Ð¸Ð¼Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº';
const SLIDE_EMOJI = 'ðŸ”Ž';

// ÐÑƒÐ¶Ð½Ð¾ Ð½Ð°Ð¹Ñ‚Ð¸ Ð²ÑÐµ Ð»Ð°Ð¹ÐºÐ¸ Ðº ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸ÑÐ¼, Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ°Ð¼Ð¸ Ð·Ð° ÑÐ¿Ñ€Ð¸Ð½Ñ‚, Ð¸ Ð¿Ñ€Ð¾ÑÑƒÐ¼Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¸Ñ… ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾.
export function prepareVoteSlide(store: Store, sprint: Sprint): VoteSlide {
    const comments = store.getSprintComments(sprint);
    const userLikeCommentsCount = Object.entries(comments.reduce(commentReducer, {}));
    userLikeCommentsCount.sort((a, b) => b[1] - a[1]);

    const users = userLikeCommentsCount.map(userVoteMapper.bind(null, store)).filter(userFilter);
    return {
        alias: SLIDE_ALIAS,
        data: {
            title: SLIDE_TITLE,
            subtitle: sprint.name,
            emoji: SLIDE_EMOJI,
            users,
        },
    };
}
